{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["var App = function () {\n    this.name = m.prop(\"\");\n    this.brief = m.prop(\"\");\n};\n\nvar newAppForm = {\n    controller: function (args) {\n        this.init = function () {\n            this.app = new App();\n            this.errors = m.prop({});\n            this.loading = m.prop();\n        };\n        this.init.apply(this);\n        this.save = function () {\n            this.loading(true);\n            m.request({ \n                method: 'POST',\n                url: '/api/app/object',\n                data: this.app,\n            }).then((data) => {\n                toastr.options.positionClass = \"toast-bottom-center\";\n                toastr.options.timeOut = 1000;\n                toastr.success('创建成功!');\n                this.init.apply(this);\n                args.onsave(data);\n            }, this.errors).then(() => {\n                this.loading('');\n            }).bind(this);\n            return false;\n        }.bind(this);\n    },\n    view: function (ctrl, args) {\n        return m('.ui.centered.grid', [\n            m('.ui.segment.eight.wide.column', [\n                m('form.ui.form', {\n                    onsubmit: ctrl.save,\n                    class: ctrl.loading()? 'loading': '',\n                }, [\n                    m('h3', '创建APP'),\n                    m(\".field\", [\n                        m('label[for=\"input-name\"]', \"APP名称\"),\n                        m('input#input-name[type=\"text\"][name=\"name\"][placeholder=\"请输入APP名称\"]', {\n                            oninput: m.withAttr('value', ctrl.app.name),\n                            value: ctrl.app.name(),\n                        }),\n                        m('.ui.pointing.red.basic.label', {\n                            class: ctrl.errors().name? \"\": \"invisible\",\n                        }, ctrl.errors().name || \"\"),\n                    ]),\n                    m('.field', [\n                        m('label[for=\"input-brief\"]', 'APP简介'),\n                        m('textarea#input-brief[placeholder=\"请输入简介\"]', {\n                            oninput: m.withAttr('value', ctrl.app.brief),\n                            value: ctrl.app.brief(),\n                        })\n                    ]),\n                    m('input.ui.button.primary[type=submit][value=\"提交\"]', {})\n                ])\n            ])\n        ]);\n    }\n};\n\nvar appGrid = {\n    view: function (ctrl, args) {\n        return (\n            m('.ui.grid', [\n                m('.ui.column', [\n                    m('.ui.segment', [\n                        m('.ui.cards', args.apps().map(function (app) {\n                            return m('.ui.card', { \n                                onclick: function () {\n                                    m.route('/app/' + app.id);\n                                } \n                            }, [\n                                m('.content', [\n                                    m('.header', app.name),\n                                    m('.meta', app.createdAt),\n                                    m('.description', app.brief)\n                                ])\n                            ]);\n                        }))\n                    ])\n                ])\n            ])\n        );\n    }\n};\n\nvar newVersionForm = {\n    view: function (ctrl, args) {\n        return (\n            m('div', [\n                m('.ui.top.attached.info.message', \"发布新版本\"),\n                m('.ui.bottom.attached.segment', [\n                    m('.ui.form', [\n                        m('.field', [\n                            m('label[for=\"input-version\"]', \"版本号(必须是x.y.z形式)\"),\n                            m('input#input-version[type=\"text\"][name=\"version\"][placeHolder=\"请输入版本号\"]')\n                        ]),\n                        m('.field', [\n                            m.component(fileButton, {\n                                onCompleted: function (path_) {\n\n                                },\n                            }),\n                        ]),\n                        m('input.ui.button.primary[type=submit][value=\"提交\"]', {})\n                    ])\n                ])\n            ])\n        );\n    }\n};\n\nvar fileButton = {\n    view: function (ctrl, args) {\n        return (\n            m('button.ui.tiny.button', {\n                style: {\n                    position: 'relative',\n                }, \n            }, [\n                m('input[type=file]', {\n                    style: {\n                        position: 'absolute',\n                        top: 0,\n                        right: 0,\n                        width: '100%',\n                        height: '100%',\n                        opacity: '0',\n                        display: 'block',\n                    },\n                    config: function (element, isinitialized) {\n                        if (!isinitialized) {\n                            element.addEventListener('change', function (e) {\n                                var data = new FormData();\n                                data.append(\"file\", e.currentTarget.files[0]);\n                                var transport = m.prop();\n                                console.log('upload begin...');\n                                m.request({\n                                    method: 'POST',\n                                    url: '/upload',\n                                    data: data,\n                                    serialize: function(data) {\n                                        return data;\n                                    },\n                                    config: transport,\n                                }).then(function () {\n                                    console.log('uploaded');\n                                }, function () {\n                                    toastr.options.positionClass = \"toast-bottom-center\";\n                                    toastr.options.timeOut = 1000;\n                                    toastr.error('上传失败');\n                                }).then(function () {\n                                    element.value = \"\";\n                                });\n                                var xhr = transport();\n                                xhr.onprogress = function (e) {\n                                    if (e.lengthComputable) {\n                                        // alert(e.loaded / e.total);\n                                        console.log(e.loaded / e.total);\n                                    }\n                                };\n                                xhr.onload = function (e) {\n                                    debugger;\n                                };\n                            });\n                        }\n                    }\n                })\n            ], '点击上传APK')\n        );\n    },\n};\n\nvar versionHistory = {\n    view: function (ctrl, args) {\n        return (\n            m('div', \"version history\")\n        );\n    },\n};\n\nm.route.mode = 'pathname';\nm.route(document.querySelector('.container'), \"/\", {\n    \"/\": {\n        controller: function () {\n            this.apps = m.request({\n                method: 'GET',\n                url: '/api/app/list',\n                deserialize: (data) => {\n                    return JSON.parse(data).data; \n                }\n            });\n            this.onsave = function (app) {\n                this.apps([app].concat(this.apps()));\n            }.bind(this);\n        },\n        view: function (ctrl) {\n            return [\n                m.component(newAppForm, {\n                    onsave: ctrl.onsave,\n                }),\n                m.component(appGrid, {\n                    apps: ctrl.apps,\n                })\n            ];\n        }\n    },\n    \"/app/:id\": {\n        controller: function (args) {\n            this.id = m.route.param('id');\n            this.app = m.request({\n                method: 'GET',\n                url: '/api/app/object/' + this.id\n            });\n        },\n        view: function (ctrl, args) {\n            return (\n                  m('.ui.segment', [\n                      m('.ui.header', ctrl.app().name),\n                      m('p', ctrl.app().brief),\n                      m.component(newVersionForm, {\n                          appId: ctrl.id\n                      }),\n                      m.component(versionHistory, {\n                          app: ctrl.app().versions,\n                      })\n                  ])\n            );\n        }\n    },\n});\n"],"sourceRoot":"/source/"}